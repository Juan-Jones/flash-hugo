{{ define "main" }}

<!-- checking blog -->
{{ if or (eq .Section "post") (eq .Section "posts") (eq .Section "blog") (eq .Section "blogs") (eq .Section "news") (eq .Section "categories") (eq .Section "tags") }}

<!--=================== section start ===================-->
<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mb-5 mb-lg-0">
        <!-- image path -->
        {{ $imagePath := .Params.image }}
{{ $altText := .Params.alt | default .Title }}

{{ if $imagePath }}
<div class="position-relative">
  <!-- External image (CDN or hosted) -->
  {{ if hasPrefix $imagePath "http" }}
    <img src="{{ $imagePath | safeURL }}" alt="{{ $altText }}" class="img-fluid mb-5 w-100 rounded-4">
  {{ else }}
    <!-- Image processing for local files -->
    {{ if or (strings.HasSuffix $imagePath "svg") (strings.HasSuffix $imagePath "gif") }}
      <img class="img-fluid mb-5 w-100 rounded-4" src="{{ $imagePath }}" alt="{{ $altText }}">
    {{ else }}
      {{ if hasPrefix $imagePath "/" }}
        {{ $image := .Resources.GetMatch (path.Split $imagePath).File }}
        {{ if $image }}
          {{ $imageFallback := $image.Resize "1400x" }}
          {{ $imageXL := $image.Resize "1400x webp" }}
          {{ $imageLG := $image.Resize "1000x webp" }}
          {{ $imageMD := $image.Resize "800x webp" }}
          {{ $imageSM := $image.Resize "600x webp" }}
          <picture>
            <source srcset="{{ $imageSM.RelPermalink }}" media="(max-width: 575px)">
            <source srcset="{{ $imageMD.RelPermalink }}" media="(max-width: 767px)">
            <source srcset="{{ $imageLG.RelPermalink }}" media="(max-width: 992px)">
            <source srcset="{{ $imageXL.RelPermalink }}">
            <img class="img-fluid mb-5 w-100 rounded-4" 
                 src="{{ $imageFallback.RelPermalink }}" 
                 alt="{{ $altText }}" 
                 width="{{ $image.Width }}" height="{{ $image.Height }}">
          </picture>
        {{ else }}
          <strong class="text-danger">`{{ $imagePath }}` doesn't exist</strong>
        {{ end }}
      {{ else }}
        {{ if fileExists (add `assets/` $imagePath) }}
          {{ $image := resources.Get $imagePath }}
          {{ $imageFallback := $image.Resize "1400x" }}
          {{ $imageXL := $image.Resize "1400x webp" }}
          {{ $imageLG := $image.Resize "1000x webp" }}
          {{ $imageMD := $image.Resize "800x webp" }}
          {{ $imageSM := $image.Resize "600x webp" }}
          <picture>
            <source srcset="{{ $imageSM.RelPermalink }}" media="(max-width: 575px)">
            <source srcset="{{ $imageMD.RelPermalink }}" media="(max-width: 767px)">
            <source srcset="{{ $imageLG.RelPermalink }}" media="(max-width: 992px)">
            <source srcset="{{ $imageXL.RelPermalink }}">
            <img class="img-fluid mb-5 w-100 rounded-4" 
                 src="{{ $imageFallback.RelPermalink }}" 
                 alt="{{ $altText }}" 
                 width="{{ $image.Width }}" height="{{ $image.Height }}">
          </picture>
        {{ else }}
          <strong class="text-danger">`{{ $imagePath }}` doesn't exist</strong>
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
</div>
{{ else }}
  <p>No image provided.</p>
{{ end }}
          
          <ul class="list-inline card-badge">
            {{ range .Params.categories }}
              <li class="list-inline-item">
                <a href="{{`categories/` | relLangURL}}{{. | lower | urlize}}" class="badge badge-primary py-1">{{. | title}}</a>
              </li>
            {{ end }}
          </ul>
        </div>
        {{ else }}
          {{ range .Params.categories }}
            <a href="{{`categories/` | relLangURL}}{{. | lower | urlize}}" class="badge badge-primary mb-4 d-inline-block">{{. | title}}</a>
          {{ end }}
        {{ end }}

        <h1 class="h3 mb-4">{{.Title | markdownify}}</h1>
        <ul class="list-inline card-meta d-flex align-items-center mb-4">
          <li class="list-inline-item d-flex align-items-center">
            <i class="fas fa-user me-2"></i>
            <a href="{{`about` | relLangURL}}">{{site.Params.author}}</a>
          </li>
          <li class="list-inline-item d-flex align-items-center">
            <i class="fas fa-calendar me-2"></i>
            <span>{{ time.Format ":date_long" .PublishDate }}</span>
          </li>
        </ul>
        <div class="content drop-cap">{{.Content}}</div>
        
        <!-- Sidebar -->
        <aside class="col-lg-4">
          {{ $widget := site.Params.widgets.sidebar }}
          {{ partialCached "widgets/widget-wrapper" (dict "Widgets" $widget "Scope" .) }}
        </aside>
      </div>
    </div>
  </section>
  
  <!-- Related Posts -->
  <section class="section-sm pt-0">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <h2 class="h4 title-border">Related Posts</h2>
        </div>
      </div>
      <div class="row">
        {{ $related := where (where site.RegularPages "Params.categories" "intersect" .Params.categories) "Title" "!=" .Title }}
        {{ range first 3 $related }}
        <div class="col-lg-4 col-md-6 mb-4">
          {{ .Render "post" }}
        </div>
        {{ end }}
      </div>
    </div>
  </section>
  {{ end }}

<!-- Breadcrumbs -->
{{ partial "breadcrumbs.html" . }}
